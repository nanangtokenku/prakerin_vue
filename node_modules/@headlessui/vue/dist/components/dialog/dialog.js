import{computed as d,defineComponent as y,h as v,inject as $,nextTick as V,onMounted as x,onUnmounted as z,provide as J,ref as D,watchEffect as Q}from"vue";import{render as O,Features as j}from'../../utils/render.js';import{Keys as W}from'../../keyboard.js';import{useId as b}from'../../hooks/use-id.js';import{FocusTrap as P}from'../../components/focus-trap/focus-trap.js';import{useInertOthers as X}from'../../hooks/use-inert-others.js';import{Portal as K,PortalGroup as Z}from'../portal/portal.js';import{StackMessage as N,useStackProvider as ee}from'../../internal/stack-context.js';import{match as F}from'../../utils/match.js';import{ForcePortalRoot as M}from'../../internal/portal-force-root.js';import{Description as te,useDescriptions as le}from'../description/description.js';import{dom as _}from'../../utils/dom.js';import{useOpenClosed as oe,State as U}from'../../internal/open-closed.js';import{useOutsideClick as ae}from'../../hooks/use-outside-click.js';import{getOwnerDocument as re}from'../../utils/owner.js';import{useEventListener as ne}from'../../hooks/use-event-listener.js';import{Hidden as ie,Features as ue}from'../../internal/hidden.js';import{useDocumentOverflowLockedEffect as se}from'../../hooks/document-overflow/use-document-overflow.js';var pe=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(pe||{});let L=Symbol("DialogContext");function C(t){let r=$(L,null);if(r===null){let e=new Error(`<${t} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(e,C),e}return r}let k="DC8F892D-2EBD-447C-A4C8-A03058436FF4",Be=y({name:"Dialog",inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},open:{type:[Boolean,String],default:k},initialFocus:{type:Object,default:null},id:{type:String,default:()=>`headlessui-dialog-${b()}`}},emits:{close:t=>!0},setup(t,{emit:r,attrs:e,slots:i,expose:n}){var H;let l=D(!1);x(()=>{l.value=!0});let u=D(0),g=oe(),m=d(()=>t.open===k&&g!==null?F(g.value,{[U.Open]:!0,[U.Closed]:!1}):t.open),E=D(new Set),f=D(null),A=D(null),w=d(()=>re(f));if(n({el:f,$el:f}),!(t.open!==k||g!==null))throw new Error("You forgot to provide an `open` prop to the `Dialog`.");if(typeof m.value!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${m.value===k?void 0:t.open}`);let c=d(()=>l.value&&m.value?0:1),I=d(()=>c.value===0),R=d(()=>u.value>1),fe=$(L,null)!==null,Y=d(()=>R.value?"parent":"leaf");X(f,d(()=>R.value?I.value:!1)),ee({type:"Dialog",enabled:d(()=>c.value===0),element:f,onUpdate:(o,a,p)=>{if(a==="Dialog")return F(o,{[N.Add](){E.value.add(p),u.value+=1},[N.Remove](){E.value.delete(p),u.value-=1}})}});let q=le({name:"DialogDescription",slot:d(()=>({open:m.value}))}),T=D(null),S={titleId:T,panelRef:D(null),dialogState:c,setTitleId(o){T.value!==o&&(T.value=o)},close(){r("close",!1)}};J(L,S);function B(){var a,p,h;return[...Array.from((p=(a=w.value)==null?void 0:a.querySelectorAll("html > *, body > *, [data-headlessui-portal]"))!=null?p:[]).filter(s=>!(s===document.body||s===document.head||!(s instanceof HTMLElement)||s.contains(_(A))||S.panelRef.value&&s.contains(S.panelRef.value))),(h=S.panelRef.value)!=null?h:f.value]}return ae(()=>B(),(o,a)=>{S.close(),V(()=>a==null?void 0:a.focus())},d(()=>c.value===0&&!R.value)),ne((H=w.value)==null?void 0:H.defaultView,"keydown",o=>{o.defaultPrevented||o.key===W.Escape&&c.value===0&&(R.value||(o.preventDefault(),o.stopPropagation(),S.close()))}),se(w,I,o=>{var a;return{containers:[...(a=o.containers)!=null?a:[],B]}}),Q(o=>{if(c.value!==0)return;let a=_(f);if(!a)return;let p=new IntersectionObserver(h=>{for(let s of h)s.boundingClientRect.x===0&&s.boundingClientRect.y===0&&s.boundingClientRect.width===0&&s.boundingClientRect.height===0&&S.close()});p.observe(a),o(()=>p.disconnect())}),()=>{let{id:o,open:a,initialFocus:p,...h}=t,s={...e,ref:f,id:o,role:"dialog","aria-modal":c.value===0?!0:void 0,"aria-labelledby":T.value,"aria-describedby":q.value},G={open:c.value===0};return v(M,{force:!0},()=>[v(K,()=>v(Z,{target:f.value},()=>v(M,{force:!1},()=>v(P,{initialFocus:p,containers:E,features:I.value?F(Y.value,{parent:P.features.RestoreFocus,leaf:P.features.All&~P.features.FocusLock}):P.features.None},()=>O({ourProps:s,theirProps:h,slot:G,attrs:e,slots:i,visible:c.value===0,features:j.RenderStrategy|j.Static,name:"Dialog"}))))),v(ie,{features:ue.Hidden,ref:A})])}}}),He=y({name:"DialogOverlay",props:{as:{type:[Object,String],default:"div"},id:{type:String,default:()=>`headlessui-dialog-overlay-${b()}`}},setup(t,{attrs:r,slots:e}){let i=C("DialogOverlay");function n(l){l.target===l.currentTarget&&(l.preventDefault(),l.stopPropagation(),i.close())}return()=>{let{id:l,...u}=t;return O({ourProps:{id:l,"aria-hidden":!0,onClick:n},theirProps:u,slot:{open:i.dialogState.value===0},attrs:r,slots:e,name:"DialogOverlay"})}}}),$e=y({name:"DialogBackdrop",props:{as:{type:[Object,String],default:"div"},id:{type:String,default:()=>`headlessui-dialog-backdrop-${b()}`}},inheritAttrs:!1,setup(t,{attrs:r,slots:e,expose:i}){let n=C("DialogBackdrop"),l=D(null);return i({el:l,$el:l}),x(()=>{if(n.panelRef.value===null)throw new Error("A <DialogBackdrop /> component is being used, but a <DialogPanel /> component is missing.")}),()=>{let{id:u,...g}=t,m={id:u,ref:l,"aria-hidden":!0};return v(M,{force:!0},()=>v(K,()=>O({ourProps:m,theirProps:{...r,...g},slot:{open:n.dialogState.value===0},attrs:r,slots:e,name:"DialogBackdrop"})))}}}),je=y({name:"DialogPanel",props:{as:{type:[Object,String],default:"div"},id:{type:String,default:()=>`headlessui-dialog-panel-${b()}`}},setup(t,{attrs:r,slots:e,expose:i}){let n=C("DialogPanel");i({el:n.panelRef,$el:n.panelRef});function l(u){u.stopPropagation()}return()=>{let{id:u,...g}=t,m={id:u,ref:n.panelRef,onClick:l};return O({ourProps:m,theirProps:g,slot:{open:n.dialogState.value===0},attrs:r,slots:e,name:"DialogPanel"})}}}),Ke=y({name:"DialogTitle",props:{as:{type:[Object,String],default:"h2"},id:{type:String,default:()=>`headlessui-dialog-title-${b()}`}},setup(t,{attrs:r,slots:e}){let i=C("DialogTitle");return x(()=>{i.setTitleId(t.id),z(()=>i.setTitleId(null))}),()=>{let{id:n,...l}=t;return O({ourProps:{id:n},theirProps:l,slot:{open:i.dialogState.value===0},attrs:r,slots:e,name:"DialogTitle"})}}}),Ne=te;export{Be as Dialog,$e as DialogBackdrop,Ne as DialogDescription,He as DialogOverlay,je as DialogPanel,Ke as DialogTitle};
